{% extends "base.html" %}
{% block title %}Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯{% endblock %}
{% block content %}
<div class="page_wrap">
  <div class="card-form" style="max-width:560px;width:100%">
    <h3>Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ ğŸ—“ï¸</h3>

    <form method="post" action="{{ url_for('book') }}">
      <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
      <input type="text" name="patient_name" placeholder="Ø§Ù„Ø§Ø³Ù…" required>

      <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
      <input type="tel" name="phone" placeholder="+9665xxxxxxxx" required>

      <label>Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</label>
      <select name="clinic_id" id="clinic" required>
        <option value="" selected disabled>Ø§Ø®ØªØ± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</option>
        {% for c in clinics %}
          <option value="{{ c.id }}">{{ c.name }}</option>
        {% endfor %}
      </select>

      <label>Ø§Ù„Ø·Ø¨ÙŠØ¨</label>
      <select name="doctor_id" id="doctor" required>
        <option value="" selected disabled>Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨</option>
        {% for d in doctors %}
          <option value="{{ d.id }}">{{ d.name }}</option>
        {% endfor %}
      </select>

      <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
      <input type="date" name="date" required>

      <label>Ø§Ù„ÙˆÙ‚Øª</label>
      <input type="time" name="time" required>

      <label>Ø§Ù„Ù…Ø¯Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
      <input type="number" name="duration" min="10" max="180" step="5" value="30" required>

      <button type="submit">Ø­Ø¬Ø²</button>
    </form>
  </div>
</div>

<script>
  // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ Ø­Ø³Ø¨ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
  const clinicSel = document.getElementById('clinic');
  const doctorSel = document.getElementById('doctor');
  clinicSel?.addEventListener('change', async () => {
    const id = clinicSel.value;
    if (!id) return;
    const res = await fetch(`/api/doctors?clinic_id=${id}`);
    const list = await res.json();
    doctorSel.innerHTML = `<option value="" selected disabled>Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨</option>`;
    list.forEach(d => {
      const opt = document.createElement('option');
      opt.value = d.id; opt.textContent = d.name;
      doctorSel.appendChild(opt);
    });
  });
</script>
{% endblock %}
