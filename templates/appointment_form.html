{% extends "base.html" %}
{% block title %}حجز موعد{% endblock %}
{% block content %}
<div class="page_wrap">
  <div class="card-form" style="max-width:560px;width:100%">
    <h3>حجز موعد 🗓️</h3>

    <form method="post" action="{{ url_for('book') }}">
      <label>الاسم الكامل</label>
      <input type="text" name="patient_name" placeholder="الاسم" required>

      <label>رقم الجوال</label>
      <input type="tel" name="phone" placeholder="+9665xxxxxxxx" required>

      <label>العيادة</label>
      <select name="clinic_id" id="clinic" required>
        <option value="" selected disabled>اختر العيادة</option>
        {% for c in clinics %}
          <option value="{{ c.id }}">{{ c.name }}</option>
        {% endfor %}
      </select>

      <label>الطبيب</label>
      <select name="doctor_id" id="doctor" required>
        <option value="" selected disabled>اختر الطبيب</option>
        {% for d in doctors %}
          <option value="{{ d.id }}">{{ d.name }}</option>
        {% endfor %}
      </select>

      <label>التاريخ</label>
      <input type="date" name="date" required>

      <label>الوقت</label>
      <input type="time" name="time" required>

      <label>المدة (دقائق)</label>
      <input type="number" name="duration" min="10" max="180" step="5" value="30" required>

      <button type="submit">حجز</button>
    </form>
  </div>
</div>

<script>
  // (اختياري) تحديث قائمة الأطباء حسب العيادة المختارة
  const clinicSel = document.getElementById('clinic');
  const doctorSel = document.getElementById('doctor');
  clinicSel?.addEventListener('change', async () => {
    const id = clinicSel.value;
    if (!id) return;
    const res = await fetch(`/api/doctors?clinic_id=${id}`);
    const list = await res.json();
    doctorSel.innerHTML = `<option value="" selected disabled>اختر الطبيب</option>`;
    list.forEach(d => {
      const opt = document.createElement('option');
      opt.value = d.id; opt.textContent = d.name;
      doctorSel.appendChild(opt);
    });
  });
</script>
{% endblock %}
